const { Telegraf } = require('telegraf');

const BOT_TOKEN = '8579547514:AAFJQR6CL_Ui2Q8-Ac0g_y4vBtwrR4tXraU';
const BASE_URL = process.env.VERCEL_URL ? `https://${process.env.VERCEL_URL}` : 'https://your-app.vercel.app';

const bot = new Telegraf(BOT_TOKEN);

// ÐŸÑ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ
bot.start(async (ctx) => {
    await ctx.reply(
        `ðŸ¦ **Crypto Wallet Pro**\n\n` +
        `ÐŸÑ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð²Ð°Ð»ÑŽÑ‚Ð½Ñ‹Ð¹ ÐºÐ¾ÑˆÐµÐ»ÐµÐº Ð´Ð»Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ð³Ð¾ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð²Ð°ÑˆÐ¸Ð¼Ð¸ Ð°ÐºÑ‚Ð¸Ð²Ð°Ð¼Ð¸.\n\n` +
        `â€¢ Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ðµ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ\n` +
        `â€¢ Ð ÐµÐ°Ð»ÑŒÐ½Ñ‹Ðµ ÐºÑƒÑ€ÑÑ‹\n` +
        `â€¢ ÐŸÑ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð°Ñ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°\n\n` +
        `ÐÐ°Ñ‡Ð½Ð¸Ñ‚Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸ÐµÐ¼:`,
        {
            parse_mode: 'Markdown',
            reply_markup: {
                inline_keyboard: [
                    [{ text: 'ðŸ“± ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ ÐºÐ¾ÑˆÐµÐ»ÐµÐº', web_app: { url: `${BASE_URL}/index.html` } }],
                    [
                        { text: 'ðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°', callback_data: 'stats' },
                        { text: 'ðŸ›¡ï¸ Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ', callback_data: 'security' }
                    ]
                ]
            }
        }
    );
});

// ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸
bot.action('help', async (ctx) => {
    await ctx.editMessageText(
        `ðŸ› ï¸ **ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ Ð¿Ð¾ Crypto Wallet Pro**\n\n` +
        `**ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸:**\n` +
        `â€¢ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ñ€Ñ‚Ñ„ÐµÐ»ÐµÐ¼\n` +
        `â€¢ Ð¢Ð¾Ñ€Ð³Ð¾Ð²Ð»Ñ ÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð²Ð°Ð»ÑŽÑ‚Ð¾Ð¹\n` +
        `â€¢ ÐžÑ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ ÐºÑƒÑ€ÑÐ¾Ð²\n` +
        `â€¢ Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸\n\n` +
        `**ÐÐ°Ñ‡Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð±Ð°Ð»Ð°Ð½Ñ:** 50,000 RUB\n` +
        `**ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°:** 7 Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ñ… ÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð²Ð°Ð»ÑŽÑ‚\n\n` +
        `Ð”Ð»Ñ Ð½Ð°Ñ‡Ð°Ð»Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¾Ñ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ.`,
        {
            parse_mode: 'Markdown',
            reply_markup: {
                inline_keyboard: [
                    [{ text: 'ðŸ“± ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ', web_app: { url: `${BASE_URL}/index.html` } }]
                ]
            }
        }
    );
});

bot.action('stats', async (ctx) => {
    await ctx.editMessageText(
        `ðŸ“ˆ **Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ñ‹**\n\n` +
        `â€¢ ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ð°ÐºÑ‚Ð¸Ð²Ñ‹: 7\n` +
        `â€¢ ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ†ÐµÐ½: ÐºÐ°Ð¶Ð´Ñ‹Ðµ 30 ÑÐµÐº\n` +
        `â€¢ Ð¢Ð¾Ñ€Ð³Ð¾Ð²Ñ‹Ðµ Ð¿Ð°Ñ€Ñ‹: RUB\n` +
        `â€¢ Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ: SSL/TLS\n\n` +
        `ÐŸÐ»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð² Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸.`,
        {
            parse_mode: 'Markdown',
            reply_markup: {
                inline_keyboard: [
                    [{ text: 'ðŸ“± ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ', web_app: { url: `${BASE_URL}/index.html` } }]
                ]
            }
        }
    );
});

bot.action('security', async (ctx) => {
    await ctx.editMessageText(
        `ðŸ›¡ï¸ **Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ**\n\n` +
        `â€¢ Ð¨Ð¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…\n` +
        `â€¢ Ð—Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ð½Ñ‹Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸\n` +
        `â€¢ Ð ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð¾Ðµ Ñ€ÐµÐ·ÐµÑ€Ð²Ð½Ð¾Ðµ ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ\n` +
        `â€¢ ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸\n\n` +
        `Ð’Ð°ÑˆÐ¸ Ð°ÐºÑ‚Ð¸Ð²Ñ‹ Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ñ‹ Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ð¾Ð¹ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸.`,
        {
            parse_mode: 'Markdown',
            reply_markup: {
                inline_keyboard: [
                    [{ text: 'ðŸ“± ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ', web_app: { url: `${BASE_URL}/index.html` } }]
                ]
            }
        }
    );
});

module.exports = async (req, res) => {
    if (req.method === 'POST') {
        try {
            await bot.handleUpdate(req.body);
            res.status(200).send('OK');
        } catch (error) {
            console.error('Error handling update:', error);
            res.status(500).send('Error');
        }
    } else {
        res.status(200).send('Crypto Wallet Pro is running!');
    }
};
